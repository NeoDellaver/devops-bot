#!/bin/bash
# ๐ ะกะบัะธะฟั ะดะธะฐะณะฝะพััะธะบะธ devops-bot

echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo "๐ ะะะะะะะกะขะะะ DEVOPS-BOT"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo ""

cd /root/devops-bot

# ะัะพะฒะตัะบะฐ 1: ะกัะฐััั ัะตัะฒะธัะฐ
echo "๐ ะกัะฐััั ัะตัะฒะธัะฐ:"
sudo systemctl status devops-bot.service --no-pager | head -20
echo ""

# ะัะพะฒะตัะบะฐ 2: ะะพัะปะตะดะฝะธะต ะพัะธะฑะบะธ
echo "โ ะะพัะปะตะดะฝะธะต ะะจะะะะ ะฒ ะปะพะณะฐั:"
sudo journalctl -u devops-bot.service -n 30 --no-pager | grep -E "ERROR|Exception|Traceback|CRITICAL" || echo "โ ะัะธะฑะพะบ ะฝะต ะฝะฐะนะดะตะฝะพ"
echo ""

# ะัะพะฒะตัะบะฐ 3: ะะพัะปะตะดะฝะธะต 50 ัััะพะบ ะปะพะณะพะฒ
echo "๐ ะะพัะปะตะดะฝะธะต 50 ัััะพะบ ะปะพะณะพะฒ:"
sudo journalctl -u devops-bot.service -n 50 --no-pager
echo ""

# ะัะพะฒะตัะบะฐ 4: ะัะพัะตัั Python
echo "๐ ะัะพัะตัั bot.py:"
ps aux | grep -E "bot\.py|devops" | grep -v grep || echo "โ ะัะพัะตัั ะฝะต ะทะฐะฟััะตะฝ"
echo ""

# ะัะพะฒะตัะบะฐ 5: ะัะพะฒะตัะบะฐ ะบะพะฝัะธะณะฐ
echo "๐ ะัะพะฒะตัะบะฐ config.py:"
if [ -f "config.py" ]; then
    echo "โ config.py ัััะตััะฒัะตั"
    # ะัะพะฒะตัะธัั ะตััั ะปะธ BOT_TOKEN
    if grep -q "BOT_TOKEN" config.py; then
        echo "โ BOT_TOKEN ะฝะฐะนะดะตะฝ"
    else
        echo "โ BOT_TOKEN ะะ ะฝะฐะนะดะตะฝ ะฒ config.py!"
    fi
else
    echo "โ config.py ะฝะต ะฝะฐะนะดะตะฝ!"
fi
echo ""

# ะัะพะฒะตัะบะฐ 6: ะัะพะฒะตัะบะฐ database
echo "๐พ ะัะพะฒะตัะบะฐ database.py:"
if [ -f "database.py" ]; then
    echo "โ database.py ัััะตััะฒัะตั"
else
    echo "โ database.py ะฝะต ะฝะฐะนะดะตะฝ!"
fi
echo ""

# ะัะพะฒะตัะบะฐ 7: ะัะพะฒะตัะบะฐ handlers
echo "๐ ะัะพะฒะตัะบะฐ handlers:"
if [ -d "handlers" ]; then
    ls -la handlers/ | grep ".py"
else
    echo "โ ะะฐะฟะบะฐ handlers ะฝะต ะฝะฐะนะดะตะฝะฐ!"
fi
echo ""

# ะัะพะฒะตัะบะฐ 8: ะกะธะฝัะฐะบัะธั Python
echo "โ๏ธ ะัะพะฒะตัะบะฐ ัะธะฝัะฐะบัะธัะฐ bot.py:"
source venv/bin/activate 2>/dev/null
python3 fix_encoding.py 2>/dev/null || true  # ะัะฟัะฐะฒะธัั ะบะพะดะธัะพะฒะบั ัะฐะนะปะพะฒ
python3 -m py_compile bot.py 2>&1 && echo "โ ะกะธะฝัะฐะบัะธั OK" || echo "โ ะัะธะฑะบะฐ ัะธะฝัะฐะบัะธัะฐ!"
deactivate 2>/dev/null
echo ""

echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo "๐ ะะะฏ ะะะะะะะะะฃะะะ ะะซะะะะะะขะ:"
echo "sudo systemctl restart devops-bot.service"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
